"use strict";var CONTENT_SELECTOR="#content",IMAGE_WRAPPER_SELECTOR="#image-wrapper",SPINNER_SELECTOR="#spinner",TYPE_FACTORY="FACTORY",TYPE_CATALOG="CATALOG",baseUrl="https://aliante.outsystemscloud.com/ALIANTE_ADMIN/rest/api/",step=0,currentCatalog=0,backButton="<span id='back' class=\"glyphicon glyphicon-chevron-left\" onclick='showHideSpinner(false); changeStep(step - 1, currentCatalog);'></span>";function render(a){0===step?loadFactories():1===step?loadCatalogs(a):2===step&&loadImages(a)}function changeStep(a,t){0===(step=a)?($(CONTENT_SELECTOR).css("opacity",0),setTimeout(render,500)):render(t)}function showHideSpinner(a){$(SPINNER_SELECTOR).css("opacity",a?1:0)}function loadFactories(){var a=sessionStorage.getItem(TYPE_FACTORY);a?drawFactories(JSON.parse(a)):(showHideSpinner(!0),$.get(baseUrl+"factories").then(function(a){sessionStorage.setItem(TYPE_FACTORY,JSON.stringify(a)),showHideSpinner(!1),drawFactories(a)}))}function loadCatalogs(t){currentCatalog=t,$(CONTENT_SELECTOR).css("opacity",0);var e=JSON.parse(sessionStorage.getItem(TYPE_FACTORY)).filter(function(a){return a.factory.Id===Number(t)})[0];t===sessionStorage.getItem("currentFactory")?drawCatalogs(e,JSON.parse(sessionStorage.getItem("catalogs"))):(showHideSpinner(!0),$.get(baseUrl+"factory/"+t+"/catalogs").then(function(a){sessionStorage.setItem("catalogs",JSON.stringify(a)),sessionStorage.setItem("currentFactory",t),showHideSpinner(!1),drawCatalogs(e,a)}))}function loadImages(a){$(CONTENT_SELECTOR).css("opacity",0),$.get(baseUrl+"catalog/"+a).then(drawCatalog),setTimeout(function(){showHideSpinner(!0),$.get(baseUrl+"catalog/"+a+"/images").then(drawImages)},600)}function drawFactories(a){var e="";$(a).each(function(a,t){e+=drawElement(TYPE_FACTORY,t)}),$(CONTENT_SELECTOR).html(e),$(CONTENT_SELECTOR).css("opacity",1),$(".logo").click(function(a){changeStep(1,a.currentTarget.id)})}function drawCatalogs(t,o){if(t){var i=t.factory;setTimeout(function(){var e="<div id='concrete-factory'>"+backButton+"<h1>"+i.Name+"</h1>",a=i.Description?i.Description:"";e+='<img src="data:image/png;base64,'+t.logo+'" alt="'+i.Name+' logo"><div><h3>'+a+"</h3>",$(o).each(function(a,t){e+=drawElement(TYPE_CATALOG,t)}),e+="</div></div>",$(CONTENT_SELECTOR).html(e),$(CONTENT_SELECTOR).css("opacity",1),$(".catalog").click(function(a){changeStep(2,a.currentTarget.id)})},500)}}function drawCatalog(t){var e=t.catalog;setTimeout(function(){var a="<div id='concrete-factory'>"+backButton+"<h1>"+e.Name+"</h1>";a+="<img style='max-width: 200px;margin-top: 10px;' src=\"data:image/png;base64,"+t.logo+'" alt="'+e.Name+' logo"/>',a+="<div id='image-wrapper'></div></div></div>",$(CONTENT_SELECTOR).html(a),$(CONTENT_SELECTOR).css("opacity",1)},500)}function drawImages(a){showHideSpinner(!1),a=a.imageList;var e="";$(a).each(function(a,t){e+="<div class='mt-30'><img src=\"data:image/png;base64,"+t+'" alt="Фото в интерьере"/></div>'}),$(IMAGE_WRAPPER_SELECTOR).html(e),$(IMAGE_WRAPPER_SELECTOR).css("opacity",1)}function drawElement(a,t){switch(a){case TYPE_FACTORY:return"<div id='"+t.factory.Id+'\' class="logo"><img src="data:image/png;base64,'+t.logo+'" alt="'+t.factory.Name+' logo"></div>';case TYPE_CATALOG:return"<div id='"+t.catalog.Id+'\' class="catalog"><img src="data:image/png;base64,'+t.logo+'" alt="'+t.catalog.Description+'"></div>'}}$(document).ready(render);